<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Mini Brawl</title>
<style>
html,body{margin:0;overflow:hidden;font-family:Arial;background:#111;color:white}
.screen{
 position:fixed;top:0;left:0;width:100%;height:100%;
 display:flex;flex-direction:column;
 align-items:center;justify-content:center;
 background:#111;z-index:20
}
button{
 padding:14px 24px;font-size:18px;
 border:none;border-radius:12px;
 background:#ffd000;color:black;margin:8px
}
#hud{position:fixed;top:10px;left:10px;z-index:5}
.joy{
 position:fixed;width:120px;height:120px;border-radius:50%;
 background:rgba(255,255,255,.15);z-index:5
}
#moveJoy{left:20px;bottom:20px}
#aimJoy{right:20px;bottom:20px}
.knob{
 width:40px;height:40px;border-radius:50%;
 background:white;position:absolute;left:40px;top:40px
}
.action{
 position:fixed;width:70px;height:70px;border-radius:50%;
 border:none;font-size:22px;color:black;z-index:5
}
#gadget{right:160px;bottom:20px;background:#00ff00}
#super{right:160px;bottom:110px;background:#ffdd00}
</style>
</head>
<body>

<!-- LOBBY -->
<div id="lobby" class="screen">
 <h1>MINI BRAWL</h1>
 <button onclick="selectMode('brawlball')">‚öΩ Brawl Ball</button>
 <button onclick="selectMode('showdown')">‚ò†Ô∏è Showdown</button>
 <button onclick="selectMode('bounty')">‚≠ê Bounty</button>
</div>

<!-- MATCHMAKING -->
<div id="matchmaking" class="screen" style="display:none">
 <h2>Finding players‚Ä¶</h2>
 <p id="mmCount">1 / 9</p>
</div>

<!-- GAME UI -->
<div id="hud" style="display:none">
 HP: <span id="hp">100</span>
 <span id="score"></span>
</div>

<div id="moveJoy" class="joy"><div class="knob"></div></div>
<div id="aimJoy" class="joy"><div class="knob"></div></div>
<button id="gadget" class="action">üü¢</button>
<button id="super" class="action">üü°</button>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script>
/* ---------- GLOBAL STATE ---------- */
let mode=null;
let scene,camera,renderer,player;
let joyMove={x:0,y:0}, joyAim={x:0,y:-1};
let bullets=[], enemies=[], walls=[];
let hp=100, score=0;

/* ---------- MODE SELECT ---------- */
function selectMode(m){
 mode=m;
 document.getElementById("lobby").style.display="none";
 document.getElementById("matchmaking").style.display="flex";
 fakeMatchmaking();
}

/* ---------- FAKE MATCHMAKING ---------- */
function fakeMatchmaking(){
 let count=1;
 const lbl=document.getElementById("mmCount");
 const int=setInterval(()=>{
  count++;
  lbl.innerText=count+" / 9";
  if(count>=9){
   clearInterval(int);
   startGame();
  }
 },300);
}

/* ---------- START GAME ---------- */
function startGame(){
 document.getElementById("matchmaking").style.display="none";
 document.getElementById("hud").style.display="block";
 initGame();
}
/* ---------- JOYSTICKS ---------- */
function setupJoystick(el, cb){
 const knob=el.querySelector(".knob");
 let active=false,start={x:0,y:0};
 el.addEventListener("touchstart",e=>{
  active=true;
  start.x=e.touches[0].clientX;
  start.y=e.touches[0].clientY;
 });
 el.addEventListener("touchmove",e=>{
  if(!active) return;
  const dx=e.touches[0].clientX-start.x;
  const dy=e.touches[0].clientY-start.y;
  const mag=Math.min(40,Math.hypot(dx,dy));
  const ang=Math.atan2(dy,dx);
  knob.style.left=40+Math.cos(ang)*mag+"px";
  knob.style.top =40+Math.sin(ang)*mag+"px";
  cb(Math.cos(ang)*(mag/40),Math.sin(ang)*(mag/40));
 });
 el.addEventListener("touchend",()=>{
  active=false;
  knob.style.left="40px";knob.style.top="40px";
  cb(0,0);
 });
}
setupJoystick(document.getElementById("moveJoy"),(x,y)=>joyMove={x,y});
setupJoystick(document.getElementById("aimJoy"),(x,y)=>joyAim={x,y});

/* ---------- INIT GAME ---------- */
function initGame(){
 scene=new THREE.Scene();
 scene.background=new THREE.Color(0xe6c48f);

 camera=new THREE.PerspectiveCamera(60,innerWidth/innerHeight,.1,200);
 camera.position.set(0,15,20);

 renderer=new THREE.WebGLRenderer({antialias:true});
 renderer.setSize(innerWidth,innerHeight);
 document.body.appendChild(renderer.domElement);

 scene.add(new THREE.AmbientLight(0xffffff,1));

 /* FLOOR */
 const floor=new THREE.Mesh(
  new THREE.PlaneGeometry(80,80),
  new THREE.MeshBasicMaterial({color:0xd2b48c})
 );
 floor.rotation.x=-Math.PI/2;
 scene.add(floor);

 /* PLAYER */
 player=new THREE.Mesh(
  new THREE.CylinderGeometry(1,1,1.5,16),
  new THREE.MeshBasicMaterial({color:0x00ffff})
 );
 player.position.y=.75;
 scene.add(player);

 /* CACTUSES (WALLS) */
 for(let i=0;i<12;i++){
  const c=new THREE.Mesh(
   new THREE.CylinderGeometry(1.2,1.2,4,8),
   new THREE.MeshBasicMaterial({color:0x228b22})
  );
  c.position.set((Math.random()-0.5)*60,2,(Math.random()-0.5)*60);
  scene.add(c);
  walls.push(c);
 }

 /* ENEMIES */
 for(let i=0;i<8;i++){
  const e=new THREE.Mesh(
   new THREE.BoxGeometry(2,2,2),
   new THREE.MeshBasicMaterial({color:0xff3333})
  );
  e.position.set((Math.random()-0.5)*50,1,(Math.random()-0.5)*50);
  e.hp=60;
  scene.add(e);
  enemies.push(e);
 }

 if(mode==="bounty"){
  document.getElementById("score").innerText=" | Score: 0";
 }

 if(mode==="showdown") initGas();

 loop();
}

/* ---------- SHOOT ---------- */
let shootCooldown=0;
function shoot(){
 if(shootCooldown>0) return;
 shootCooldown=20;
 const b=new THREE.Mesh(
  new THREE.SphereGeometry(.3),
  new THREE.MeshBasicMaterial({color:0xffffff})
 );
 b.position.copy(player.position);
 b.dir=new THREE.Vector3(joyAim.x,0,joyAim.y).normalize();
 scene.add(b);
 bullets.push(b);
}

/* ---------- SUPER ---------- */
document.getElementById("super").onclick=()=>{
 player.position.x+=joyAim.x*6;
 player.position.z+=joyAim.y*6;
};

/* ---------- GADGET ---------- */
document.getElementById("gadget").onclick=()=>{
 hp=Math.min(100,hp+30);
 document.getElementById("hp").innerText=Math.floor(hp);
};

/* ---------- SHOWDOWN GAS ---------- */
let gasRadius=40;
function initGas(){
 gasRadius=40;
}
function updateGas(){
 gasRadius-=0.01;
 if(player.position.length()>gasRadius){
  hp-=0.2;
 }
}

/* ---------- GAME LOOP ---------- */
function loop(){
 requestAnimationFrame(loop);

 shootCooldown--;

 if(joyAim.x||joyAim.y) shoot();

 /* MOVE */
 player.position.x+=joyMove.x*0.3;
 player.position.z+=joyMove.y*0.3;

 /* BULLETS */
 bullets.forEach((b,i)=>{
  b.position.add(b.dir.clone().multiplyScalar(0.6));
  enemies.forEach((e,ei)=>{
   if(b.position.distanceTo(e.position)<1.5){
    e.hp-=20;
    scene.remove(b);
    bullets.splice(i,1);
    if(e.hp<=0){
     scene.remove(e);
     enemies.splice(ei,1);
     if(mode==="bounty"){
      score++;
      document.getElementById("score").innerText=" | Score: "+score;
     }
    }
   }
  });
 });

 /* ENEMY AI */
 enemies.forEach(e=>{
  const dir=player.position.clone().sub(e.position).normalize();
  e.position.add(dir.multiplyScalar(0.08));
  if(e.position.distanceTo(player.position)<2){
   hp-=0.3;
  }
 });

 if(mode==="showdown") updateGas();

 document.getElementById("hp").innerText=Math.floor(hp);

 camera.position.x+=(player.position.x-camera.position.x)*0.05;
 camera.position.z+=(player.position.z+20-camera.position.z)*0.05;
 camera.lookAt(player.position);

 renderer.render(scene,camera);
}
</script>
</body>
</html>