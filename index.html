<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Mini Brawl</title>
<style>
html,body{margin:0;overflow:hidden;background:#c2b280}
#hp{position:fixed;top:10px;left:10px;color:white;font-family:Arial}
.joy{
 position:fixed;left:20px;bottom:20px;
 width:120px;height:120px;border-radius:50%;
 background:rgba(255,255,255,.15)
}
.knob{
 width:40px;height:40px;border-radius:50%;
 background:white;position:absolute;left:40px;top:40px
}
button{
 position:fixed;width:70px;height:70px;border-radius:50%;
 border:none;font-size:22px;color:black
}
#gadget{right:20px;bottom:110px;background:#00ff00}
#super{right:20px;bottom:20px;background:#ffdd00}
</style>
</head>
<body>

<div id="hp">HP: 100</div>
<div class="joy" id="joy"><div class="knob"></div></div>
<button id="gadget">ðŸŸ¢</button>
<button id="super">ðŸŸ¡</button>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script>
const scene=new THREE.Scene();
scene.background=new THREE.Color(0xe6d3a3); // desert sky

const camera=new THREE.PerspectiveCamera(60,innerWidth/innerHeight,.1,100);
camera.position.set(0,12,18);

const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff,1));

// desert floor
const floor=new THREE.Mesh(
 new THREE.PlaneGeometry(60,60),
 new THREE.MeshBasicMaterial({color:0xd2b48c})
);
floor.rotation.x=-Math.PI/2;
scene.add(floor);

// player
const player=new THREE.Mesh(
 new THREE.CylinderGeometry(1,1,1.5,16),
 new THREE.MeshBasicMaterial({color:0x00ffff})
);
player.position.y=.75;
scene.add(player);

let hp=100;
let speed=.25;
let joyX=0,joyY=0;
let dashVX=0,dashVZ=0;
let dashing=false;

const enemies=[];

// joystick
const joy=document.getElementById("joy");
const knob=joy.querySelector(".knob");
joy.addEventListener("touchmove",e=>{
 const r=joy.getBoundingClientRect();
 let dx=e.touches[0].clientX-(r.left+r.width/2);
 let dy=e.touches[0].clientY-(r.top+r.height/2);
 const d=Math.hypot(dx,dy);
 if(d>40){dx*=40/d;dy*=40/d}
 knob.style.transform=`translate(${dx}px,${dy}px)`;
 joyX=dx/40; joyY=dy/40;
},{passive:false});
joy.addEventListener("touchend",()=>{
 joyX=joyY=0;knob.style.transform="";
});

// spawn enemies
for(let i=0;i<5;i++){
 const e=new THREE.Mesh(
  new THREE.BoxGeometry(2,2,2),
  new THREE.MeshBasicMaterial({color:0xff3333})
 );
 e.position.set((Math.random()-0.5)*40,1,(Math.random()-0.5)*40);
 scene.add(e);
 enemies.push(e);
}

// gadget (heal)
document.getElementById("gadget").onclick=()=>{
 hp=Math.min(100,hp+25);
 document.getElementById("hp").innerText="HP: "+hp;
};

// super dash (FIXED)
document.getElementById("super").onclick=()=>{
 if(dashing) return;
 dashing=true;
 const len=Math.hypot(joyX,joyY)||1;
 dashVX=(joyX/len)*1.5;
 dashVZ=(joyY/len)*1.5;
 setTimeout(()=>{
  dashing=false;
  dashVX=dashVZ=0;
 },250);
};

// game loop
function loop(){
 requestAnimationFrame(loop);

 // movement
 if(dashing){
  player.position.x+=dashVX;
  player.position.z+=dashVZ;
 }else{
  player.position.x+=joyX*speed;
  player.position.z+=joyY*speed;
 }

 // enemy AI (chase player)
 enemies.forEach(e=>{
  const dir=player.position.clone().sub(e.position);
  const dist=dir.length();
  dir.normalize();
  e.position.add(dir.multiplyScalar(0.03));
  if(dist<2){
   hp-=0.3;
   document.getElementById("hp").innerText="HP: "+Math.floor(hp);
  }
 });

 // camera follow (smooth)
 camera.position.x+=(player.position.x-camera.position.x)*0.05;
 camera.position.z+=(player.position.z+18-camera.position.z)*0.05;
 camera.lookAt(player.position);

 renderer.render(scene,camera);
}
loop();
</script>
</body>
</html>