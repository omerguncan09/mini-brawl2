<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Mini Brawl</title>
<style>
html,body{margin:0;overflow:hidden;background:#c2b280}
#hp{position:fixed;top:10px;left:10px;color:white;font-family:Arial}
.joy{
 position:fixed;left:20px;bottom:20px;
 width:120px;height:120px;border-radius:50%;
 background:rgba(255,255,255,.15)
}
.knob{
 width:40px;height:40px;border-radius:50%;
 background:white;position:absolute;left:40px;top:40px
}
button{
 position:fixed;width:70px;height:70px;border-radius:50%;
 border:none;font-size:22px;color:black
}
#gadget{right:20px;bottom:110px;background:#00ff00}
#super{right:20px;bottom:20px;background:#ffdd00}
</style>
</head>
<body>

<div id="hp">HP: 100</div>
<div class="joy" id="joy"><div class="knob"></div></div>
<button id="gadget">ðŸŸ¢</button>
<button id="super">ðŸŸ¡</button>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script>
/* ---------- SETUP ---------- */
const scene=new THREE.Scene();
scene.background=new THREE.Color(0xe6d3a3);

const camera=new THREE.PerspectiveCamera(60,innerWidth/innerHeight,.1,100);
camera.position.set(0,12,18);

const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff,1));

/* ---------- MAP ---------- */
const floor=new THREE.Mesh(
 new THREE.PlaneGeometry(60,60),
 new THREE.MeshBasicMaterial({color:0xd2b48c})
);
floor.rotation.x=-Math.PI/2;
scene.add(floor);

/* ---------- PLAYER ---------- */
const player=new THREE.Mesh(
 new THREE.CylinderGeometry(1,1,1.5,16),
 new THREE.MeshBasicMaterial({color:0x00ffff})
);
player.position.y=.75;
scene.add(player);

let hp=100;
let speed=.25;
let joyX=0,joyY=0;
let dashVX=0,dashVZ=0;
let dashing=false;

/* ---------- ARRAYS ---------- */
const enemies=[];
const bullets=[];
const enemyBullets=[];
const walls=[];

/* ---------- CACTUSES (WALLS) ---------- */
for(let i=0;i<8;i++){
 const c=new THREE.Mesh(
  new THREE.CylinderGeometry(1,1.2,4,8),
  new THREE.MeshBasicMaterial({color:0x2e8b57})
 );
 c.position.set((Math.random()-0.5)*45,2,(Math.random()-0.5)*45);
 scene.add(c);
 walls.push(c);
}

/* ---------- JOYSTICK ---------- */
const joy=document.getElementById("joy");
const knob=joy.querySelector(".knob");
joy.addEventListener("touchmove",e=>{
 const r=joy.getBoundingClientRect();
 let dx=e.touches[0].clientX-(r.left+r.width/2);
 let dy=e.touches[0].clientY-(r.top+r.height/2);
 const d=Math.hypot(dx,dy);
 if(d>40){dx*=40/d;dy*=40/d}
 knob.style.transform=`translate(${dx}px,${dy}px)`;
 joyX=dx/40; joyY=dy/40;
},{passive:false});
joy.addEventListener("touchend",()=>{
 joyX=joyY=0;knob.style.transform="";
});

/* ---------- ENEMIES ---------- */
for(let i=0;i<5;i++){
 const e=new THREE.Mesh(
  new THREE.BoxGeometry(2,2,2),
  new THREE.MeshBasicMaterial({color:0xff3333})
 );
 e.position.set((Math.random()-0.5)*40,1,(Math.random()-0.5)*40);
 e.hp=40;
 scene.add(e);
 enemies.push(e);
}

/* ---------- BUTTONS ---------- */
document.getElementById("gadget").onclick=()=>{
 hp=Math.min(100,hp+25);
 document.getElementById("hp").innerText="HP: "+hp;
};

document.getElementById("super").onclick=()=>{
 if(dashing) return;
 dashing=true;
 const len=Math.hypot(joyX,joyY)||1;
 dashVX=(joyX/len)*1.5;
 dashVZ=(joyY/len)*1.5;
 setTimeout(()=>{
  dashing=false;
  dashVX=dashVZ=0;
 },250);
};

/* ---------- SHOOTING ---------- */
setInterval(()=>{
 const b=new THREE.Mesh(
  new THREE.SphereGeometry(.3),
  new THREE.MeshBasicMaterial({color:0x00ffff})
 );
 b.position.copy(player.position);
 b.dir=new THREE.Vector3(0,0,-1);
 scene.add(b);
 bullets.push(b);
},500);

/* ---------- ENEMY SHOOT ---------- */
setInterval(()=>{
 enemies.forEach(e=>{
  const b=new THREE.Mesh(
   new THREE.SphereGeometry(.3),
   new THREE.MeshBasicMaterial({color:0xff0000})
  );
  b.position.copy(e.position);
  b.dir=player.position.clone().sub(e.position).normalize();
  scene.add(b);
  enemyBullets.push(b);
 });
},1200);

/* ---------- GAME LOOP ---------- */
function loop(){
 requestAnimationFrame(loop);

 // movement
 let nx=player.position.x+(dashing?dashVX:joyX*speed);
 let nz=player.position.z+(dashing?dashVZ:joyY*speed);

 // wall collision
 let blocked=false;
 walls.forEach(w=>{
  if(new THREE.Vector3(nx,player.position.y,nz).distanceTo(w.position)<2){
   blocked=true;
  }
 });
 if(!blocked){
  player.position.x=nx;
  player.position.z=nz;
 }

 // enemies chase
 enemies.forEach(e=>{
  const dir=player.position.clone().sub(e.position);
  const dist=dir.length();
  dir.normalize();
  e.position.add(dir.multiplyScalar(0.03));
  if(dist<2){
   hp-=0.3;
   document.getElementById("hp").innerText="HP: "+Math.floor(hp);
  }
 });

 // bullets
 bullets.forEach((b,i)=>{
  b.position.add(b.dir.clone().multiplyScalar(.6));
  walls.forEach(w=>{
   if(b.position.distanceTo(w.position)<1){
    scene.remove(b);bullets.splice(i,1);
   }
  });
 });

 enemyBullets.forEach((b,i)=>{
  b.position.add(b.dir.clone().multiplyScalar(.4));
  if(b.position.distanceTo(player.position)<1.2){
   hp-=5;
   document.getElementById("hp").innerText="HP: "+hp;
   scene.remove(b);enemyBullets.splice(i,1);
  }
 });

 // camera
 camera.position.x+=(player.position.x-camera.position.x)*0.05;
 camera.position.z+=(player.position.z+18-camera.position.z)*0.05;
 camera.lookAt(player.position);

 renderer.render(scene,camera);
}
loop();
</script>
</body>
</html>