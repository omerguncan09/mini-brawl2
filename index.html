<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Mini Brawl</title>
<style>
html,body{margin:0;overflow:hidden;background:#000}
button{
 position:fixed;
 width:70px;height:70px;
 border-radius:50%;
 font-size:24px;
 border:none;
 color:black;
}
#gadget{right:20px;bottom:110px;background:#00ff00}
#super{right:20px;bottom:20px;background:#ffdd00}
.joy{position:fixed;left:20px;bottom:20px;width:120px;height:120px;
 border-radius:50%;background:rgba(255,255,255,.15)}
.knob{width:40px;height:40px;border-radius:50%;background:white;
 position:absolute;left:40px;top:40px}
#hp{position:fixed;top:10px;left:10px;color:white;font-family:Arial}
</style>
</head>
<body>

<div id="hp">HP: 100</div>
<div class="joy" id="joy"><div class="knob"></div></div>
<button id="gadget">ðŸŸ¢</button>
<button id="super">ðŸŸ¡</button>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script>
const scene=new THREE.Scene();
scene.background=new THREE.Color(0x1f1f1f);

const camera=new THREE.PerspectiveCamera(60,innerWidth/innerHeight,.1,100);
const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff,1));

const floor=new THREE.Mesh(
 new THREE.PlaneGeometry(60,60),
 new THREE.MeshBasicMaterial({color:0x2f8f2f})
);
floor.rotation.x=-Math.PI/2;
scene.add(floor);

const player=new THREE.Mesh(
 new THREE.CylinderGeometry(1,1,1.5,16),
 new THREE.MeshBasicMaterial({color:0x00ffff})
);
player.position.y=.75;
scene.add(player);

let hp=100;
let speed=0.25;
let joyX=0,joyY=0;
let bullets=[], enemyBullets=[], enemies=[];

// CAMERA FOLLOW
function updateCamera(){
 camera.position.lerp(
  new THREE.Vector3(
   player.position.x,
   12,
   player.position.z+15
  ),0.08);
 camera.lookAt(player.position);
}

// JOYSTICK
const joy=document.getElementById("joy");
const knob=joy.querySelector(".knob");
joy.addEventListener("touchmove",e=>{
 const r=joy.getBoundingClientRect();
 let dx=e.touches[0].clientX-(r.left+r.width/2);
 let dy=e.touches[0].clientY-(r.top+r.height/2);
 const d=Math.hypot(dx,dy);
 if(d>40){dx*=40/d;dy*=40/d}
 knob.style.transform=`translate(${dx}px,${dy}px)`;
 joyX=dx/40; joyY=dy/40;
},{passive:false});
joy.addEventListener("touchend",()=>{
 joyX=joyY=0;knob.style.transform="";
});

// ENEMY SPAWN
function spawnEnemy(){
 const e=new THREE.Mesh(
  new THREE.BoxGeometry(2,2,2),
  new THREE.MeshBasicMaterial({color:0xff3333})
 );
 e.position.set((Math.random()-0.5)*40,1,(Math.random()-0.5)*40);
 e.hp=40;
 scene.add(e);
 enemies.push(e);
}
for(let i=0;i<5;i++)spawnEnemy();

// ENEMY SHOOT
setInterval(()=>{
 enemies.forEach(e=>{
  const b=new THREE.Mesh(
   new THREE.SphereGeometry(.3),
   new THREE.MeshBasicMaterial({color:0xff0000})
  );
  b.position.copy(e.position);
  b.dir=player.position.clone().sub(e.position).normalize();
  scene.add(b);
  enemyBullets.push(b);
 });
},1200);

// GADGET
document.getElementById("gadget").onclick=()=>{
 hp=Math.min(100,hp+30);
};

// SUPER DASH
document.getElementById("super").onclick=()=>{
 speed=1;
 setTimeout(()=>speed=0.25,400);
};

// LOOP
function loop(){
 requestAnimationFrame(loop);

 player.position.x+=joyX*speed;
 player.position.z+=joyY*speed;

 // PLAYER BULLETS (AUTO)
 if(Math.random()<0.05){
  const b=new THREE.Mesh(
   new THREE.SphereGeometry(.3),
   new THREE.MeshBasicMaterial({color:0x00ffff})
  );
  b.position.copy(player.position);
  b.dir=new THREE.Vector3(0,0,-1).applyQuaternion(player.quaternion);
  scene.add(b);
  bullets.push(b);
 }

 bullets.forEach((b,i)=>{
  b.position.add(b.dir.clone().multiplyScalar(.6));
  enemies.forEach((e,ei)=>{
   if(b.position.distanceTo(e.position)<1.5){
    e.hp-=20;
    scene.remove(b);bullets.splice(i,1);
    if(e.hp<=0){
     scene.remove(e);
     enemies.splice(ei,1);
     spawnEnemy();
    }
   }
  });
 });

 enemyBullets.forEach((b,i)=>{
  b.position.add(b.dir.clone().multiplyScalar(.4));
  if(b.position.distanceTo(player.position)<1.2){
   hp-=5;
   document.getElementById("hp").innerText="HP: "+hp;
   scene.remove(b);enemyBullets.splice(i,1);
  }
 });

 updateCamera();
 renderer.render(scene,camera);
}
loop();
</script>
</body>
</html>
